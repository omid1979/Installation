IPSec

![18de04cfd257b962edac62404e50fe1e.png](:/aefa82538f9041608268d87492ad7ef1)

**Router A**

!— Create an ISAKMP policy for Phase 1 negotiations for the L2L tunnels.

crypto isakmp policy 10  
encryption aes  
hash sha256  
authentication pre-share  
group 14

crypto isakmp key vpnuser address 10.0.0.2

!— Create the Phase 2 policy for IPsec negotiation.

crypto ipsec transform-set myset esp-aes esp-sha256-hmac

access-list 100 permit ip 10.1.1.0 0.0.0.255 172.16.2.0 0.0.0.255

crypto map mymap 10 ipsec-isakmp  
   set peer 10.0.0.2  
   set transform-set myset  
   match address 100

interface GigabitEthernet0/1  
ip address 10.1.1.2 255.255.255.0

interface GigabitEthernet0/0  
ip address 172.16.1.1 255.255.255.0  
crypto map mymap

!— Route to the default gateway  
ip route 0.0.0.0 0.0.0.0 172.16.1.2

**Router B**

!— Create an ISAKMP policy for Phase 1 negotiations for the L2L tunnels.  
crypto isakmp policy 10  
encryption aes  
hash sha256  
authentication pre-share  
group 14

crypto isakmp key vpnuser address 172.16.1.1  
!— Create the Phase 2 policy for IPsec negotiation.  
crypto ipsec transform-set myset esp-aes esp-sha256-hmac  
access-list 100 permit ip 172.16.2.0 0.0.0.255 10.1.1.0 0.0.0.255

crypto map mymap 10 ipsec-isakmp  
 set peer 172.16.1.1  
set transform-set myset  
match address 100

interface GigabitEthernet0/1  
ip address 172.16.2.1 255.255.255.0

interface GigabitEthernet0/0  
ip address 10.0.0.2 255.255.255.0  
crypto map mymap

!— Route to the default gateway.  
ip route 0.0.0.0 0.0.0.0 10.0.01

&nbsp;

&nbsp;

veryfing : 

RouterA#**show crypto ipsec sa**

RouterA#****show crypto isakmp sa****

RouterA#******show crypto map******

id: f8810b7d3bf242029d9b19a35beef731
parent_id: d65a859e7f1d49749b8a6167551b65e4
created_time: 2024-09-15T08:08:39.743Z
updated_time: 2024-09-15T08:15:05.483Z
is_conflict: 0
latitude: 35.68919750
longitude: 51.38897360
altitude: 0.0000
author: 
source_url: 
is_todo: 0
todo_due: 0
todo_completed: 0
source: joplin-desktop
source_application: net.cozic.joplin-desktop
application_data: 
order: 0
user_created_time: 2024-09-15T08:08:39.743Z
user_updated_time: 2024-09-15T08:15:05.483Z
encryption_cipher_text: 
encryption_applied: 0
markup_language: 1
is_shared: 0
share_id: 
conflict_original_id: 
master_key_id: 
user_data: 
deleted_time: 0
type_: 1