 معماری مانیتورینگ توسعه (پوسایدن)

<img src=":/ead3fb89787740e0b923bc0642b64205" alt="be68601afb7839dbadaf1aab047fc729.png" width="362" height="362" class="jop-noMdConv">

&nbsp;

<img src=":/5086681e37674195901bb7f4b47723d4" alt="b58b72a4887cc38fe22c15d53027d3ce.png" width="826" height="549" class="jop-noMdConv">

#### <span style="color: #000000;"><span style="color: #003366;">1.1 مقدمه‌ی پروژه:</span></span>

<span style="color: #003366;">با توجه به نیازمندی های تیم های توسعه و عملیات داده ورزی سداد؛ همچنین گسترده و بزرگتر شدن اکوسیستم سرویسها؛ مدیریت و جمع آوری داده های مانیتورینگ سرویس ها (**Microservices**) جهت **Continuous Monitoring** و تولید هشدارها نقش پر رنگی دارد. از این داده ها (Monitoring Metrics) که توسط خود مایکروسرویس ها تولید می شوند؛ برای ردیابی مشکلات بوجود آمده و یا مشکلاتی که ممکن است در آینده برای سرویس های تولید شده توسط توسعه دهندگان و خود زیرساخت (**IaaS**) داده ورزی سداد که در حال حاضر **K8S Cluster** ها هستند رخ دهد؛ می توان بهره برد. همچنین کاربرد بسازیی جهت پیشبرد اهداف **DevOps Integrations** خواهد داشت.  
</span>

<span style="color: #003366;">این معماری به این شکل است که با استفاده از ابزارهای مدرن و Trend مربوطه؛ از منابع مختلف موجود عم از **K8S clusters** و سرویس های **on-permise** و **lagacy**؛ متریک ها را جمع آوری کرده و به یک **Centralized Prometheus Stack** (که در این معماری Poseidon نام دارد) ارسال خواهند کرد و از طریق دسترسی end-user ها به ابزار Visualization مخصوص که در اینجا از Grafana استفاده خواهد شد میتوان از این داده ها به صورت Aggregate شده و گراف های مختلف بهره برد.</span>

#### <span style="color: #000000;"><span style="color: #003366;">1.2 اهداف سامانه:</span></span>

<span style="color: #333333;">1- با استفاده از این معماری جدید Observability کل مجموعه افزایش خواهد یافت.  
</span><span style="color: #333333;">\*۲-با توجه به نوع معماری Deploy امکان از دسترس خارج شدن ابزار به حداقل خواهد رسید.  
\*</span><span style="color: #333333;">۳-ردیابی سریع تر مشکلات احتمالی مایکروسرویس ها و کلاسترها  
</span>*۴- به دلیل مدرن بودن این stack میتوان ابزارها و سرویس های مدرن و CloudNative همچون Redis, Minio و .. را مانیتور کرد*

&nbsp;

#### <span style="color: #000000;"><span style="color: #003366;">2.1.1 معماری پروژه و معرفی اجزای پروژه:</span></span>

<span style="color: #003366;">۱- مولفه Prometheus Exporter :</span>

<span style="color: #003366;">ارسال اطلاعات مانیتورینگ سرویس های مختلف on-permise و lagacy به Centralized Monitoring  
</span>

<span style="color: #003366;">2- مولفه Prometheus Operator:  
</span>

<span style="color: #003366;">جهت مانیتورینگ K8S Cluster به صورت کامل و مستقل و ارسال دادها به <span style="color: #003366;">Centralized</span> <span style="color: #003366;">Monitoring</span></span>

<span style="color: #003366;">3- مولفه Centralized <span style="color: #003366;">Monitoring</span>:</span>

<span style="color: #003366;">کلاستر مستقل LGTM که شامل مولفه های Loki,Grafana,Tempo,Metrics و در داخل یک K8S Cluster مستقل خواهد بود.  
</span>**<span style="color: #003366;">4- مولفه Metrics در داخل کلاستر:</span>**<span style="color: #003366;">  
</span><span style="color: #003366;">این مولفه شامل Prometheus و Mimir جهت جمع آوری <span style="color: #003366;">Metrics ها</span> و نگه داشت تمامی داده های مولفه های مختلف خواهد بود.</span><span style="color: #003366;">  
</span>

**<span style="color: #003366;"><span style="color: #003366;">5- مولفه Tempo در داخل کلاستر:</span></span>**

<span style="color: #003366;"><span style="color: #003366;">این مولفه جهت جمع آوری داده های Spans استفاده می شود.  
</span></span>

<span style="color: #003366;"><span style="color: #003366;">6- مولفه Loki **در داخل کلاستر**:</span></span>

<span style="color: #003366;"><span style="color: #003366;">جهت جمع آوری دادهای Logs استفاده می شود.  
</span></span>

**<span style="color: #003366;">7- مولفه Grafana در داخل کلاستر:</span>**

<span style="color: #003366;">جهت Visualize کردن تمامی داده ها خواهد بود.  
**8-** **مولفه** **Kafka**: برای ذخیره موقت دیتاهای ارسال شده توسط منابع تولید لاگ و منتظر ماندن دریافت این دیتاها توسط مولفه ی Loki می باشد.  
**9-** **مولفه** **Redis**: مورد استفاده جهت caching system برای بهبود عملکرد query ها.  
</span>

**10- <span style="color: #003366;">مولفه Minio Cluser:</span>**

<span style="color: #003366;">این مولفه بعنوان یک Storage Backed جهت نگهداری تمامی داده هاست و پیشنهادی توسط بنیاد Grafana Stack می باشد.  
</span>

**11- <span style="color: #003366;">مولفه Cluster LB:</span>**

<span style="color: #003366;">از این مولفه برای ارتباط بین تمامی سرویس ها و سامانه ها با Centralized Monitoring استفاده می شود.</span>

#### <span style="color: #000000;"><span style="color: #003366;">2.1.2 وظایف و معرفی اجزای سامانه:</span></span>

تمامی داده های مانیتورینگ و متریک ها عم از سرویس های lagacy, docker-compose و K8S Cluster ها به یک Load ‌ Balancer و یا به کلاستر Kafka (بسته به نوع دیتا) ارسال خواهد شد و این داده ها با توجه به مشخص بودن نوع آنها به سرویس های مختلف بر روی <span style="color: #003366;">Centralized Monitoring</span> کلاستر Redirect میشوند.داده های دریافت شده در کلاستر Procces و Aggregate شده و توسط سرویس Mimir حاضر در کلاستر؛ بحث ذخیره Long-Term و Performance Query اجرا خواهد شد و این سرویس برای نگهداشت داده های خود از Minio Cluster مربوطه استفاده خواهد کرد.  
در نهایت از طریق Grafana <span style="color: #003366;">کاربرهای end-user از طریق یک Load Balancer مجزا در زون مربوط به پابلیش به این مولفه دسترسی خواهند داشت.</span>

&nbsp;

#### <span style="color: #000000;"><span style="color: #003366;">2.1.7 نحوه‌ی مانیتورینگ سامانه</span></span>:

جهت مانیتورینگ بیزینسی سامانه می بایست prometheus metrics بر روی سامانه مربوطه پیاده سازی گردد.

&nbsp;

#### <span style="color: #000000;"><span style="color: #003366;">2.1.6 Port Map:</span></span>

|     |     |     |     |     |
| --- | --- | --- | --- | :--- |
| Edge LB | Minio LB | K8S Cluster Workers Nodes | DataCenter Servers | :From  <br><br/>:To |
|     |     |     | 9080 | K8s Cluster LB |
| 30081 |     |     |     | K8S Cluster Workers |
|     |     | 9080 |     | Minio LB |
|     | 9000 |     |     | Minio Cluster Nodes |
|     |     | 26379 |     | Redis Cluster Nodes |
|     |     | 9092 | 9092 | Kafka Cluster Nodes |
|     |     | 9092 | 9091 | Kafka Cluster Nodes |

&nbsp;

&nbsp;

#### <span style="color: #000000;"><span style="color: #003366;">2.2.13 اطلاعات ساخت ماشین:</span></span>

|     |     |     |     |     |     |     |     |     |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| برنامه‌ریزی بک آپ | توضیحات ساخت ماشین | IP  | Description | Thick  <br><br/>hard  <br><br/>disk | VLAN  <br><br/>ID | CPU  <br><br/>Core | RAM  <br><br/>GB | سیستم عامل |
| ۳ روز یکبار | Poseidon-K8S-Master01 | 192.168.175.98 | Kubernetes Master Node01 | 50  | 2364 | 12  | 8   | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-K8S-Master02 | 192.168.175.99 | Kubernetes Master Node02 | 50  | 2364 | 12  | 8   | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-K8S-Master03 | 192.168.175.100 | Kubernetes Master Node03 | 50  | 2364 | 12  | 8   | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-K8S-Worker01 | 192.168.175.101 | Kubernetes Worker Node01 | 50  | 2364 | 12  | 24  | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-K8S-Worker02 | 192.168.175.102 | Kubernetes Worker Node02 | 50  | 2364 | 12  | 24  | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-K8S-Worker03 | 192.168.175.103 | Kubernetes Worker Node03 | 50  | 2364 | 12  | 24  | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-K8S-Worker04 | 192.168.175.104 | Kubernetes Worker Node04 | 50  | 2364 | 12  | 24  | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-K8S-Worker05 | 192.168.175.105 | Kubernetes Worker Node05 | 50  | 2364 | 12  | 24  | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-K8S-Worker06 | 192.168.175.106 | Kubernetes Worker Node06 | 50  | 2364 | 12  | 24  | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-Minio-Node01 | 192.168.175.130 | Minio Cluster Node01 | 300 | 2365 | 12  | 12  | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-Minio-Node02 | 192.168.175.131 | Minio Cluster Node02 | 300 | 2365 | 12  | 12  | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-Minio-Node03 | 192.168.175.132 | Minio Cluster Node03 | 300 | 2365 | 12  | 12  | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-Minio-Node04 | 192.168.175.133 | Minio Cluster Node04 | 300 | 2365 | 12  | 12  | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-Minio-Node05 | 192.168.175.134 | Minio Cluster Node05 | 300 | 2365 | 12  | 12  | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-Minio-Node06 | 192.168.175.135 | Minio Cluster Node06 | 300 | 2365 | 12  | 12  | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-Minio-Node07 | 192.168.175.136 | Minio Cluster Node07 | 300 | 2365 | 12  | 12  | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-Minio-Node08 | 192.168.175.137 | Minio Cluster Node08 | 300 | 2365 | 12  | 12  | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-Minio-LB1 | 192.168.175.138 | Minio Cluster LB01 | 50  | 2365 | 4   | 4   | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-Minio-LB2 | 192.168.175.139 | Minio Cluster LB02 | 50  | 2365 | 4   | 4   | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-Kafka1 | 192.168.175.107 | Kafka Cluster Node1 | 50  | 2364 | 8   | 8   | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-Kafka2 | 192.168.175.108 | Kafka Cluster Node2 | 50  | 2364 | 8   | 8   | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-Kafka3 | 192.168.175.109 | Kafka Cluster Node3 | 50  | 2364 | 8   | 8   | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-Redis1 | 192.168.175.162 | Redis Cluster Node1 | 50  | 2366 | 4   | 24  | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-Redis2 | 192.168.175.163 | Redis Cluster Node2 | 50  | 2366 | 4   | 24  | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-Redis3 | 192.168.175.164 | Redis Cluster Node3 | 50  | 2366 | 4   | 24  | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-Grafana-LB01 | 192.168.160.76 | Grafana LB01 | 30  | 1202 | 4   | 4   | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-Grafana-LB02 | 192.168.160.77 | Grafana LB02 | 30  | 1202 | 4   | 4   | Ubuntu 20.04 |
| ۳ روز یکبار | Poseidon-K8S-LB01 | 192.168.175.111 | K8S LB01 | 20  | 1202 | 4   | 4   | Ubuntu 22.04 |
| ۳ روز یکبار | Poseidon-K8S-LB02 | 192.168.175.112 | K8S LB02 | 20  | 1202 | 4   | 4   | Ubuntu 22.04 |

id: 393f9abb91ea436a9dc337c08f26c451
parent_id: 570588f72e8a457f9e1c311f38fc711a
created_time: 2024-08-12T11:13:32.780Z
updated_time: 2024-08-13T07:43:55.648Z
is_conflict: 0
latitude: 35.68919750
longitude: 51.38897360
altitude: 0.0000
author: 
source_url: 
is_todo: 0
todo_due: 0
todo_completed: 0
source: joplin-desktop
source_application: net.cozic.joplin-desktop
application_data: 
order: 0
user_created_time: 2024-08-12T11:13:32.780Z
user_updated_time: 2024-08-13T07:43:55.648Z
encryption_cipher_text: 
encryption_applied: 0
markup_language: 1
is_shared: 0
share_id: 
conflict_original_id: 
master_key_id: 
user_data: 
deleted_time: 0
type_: 1