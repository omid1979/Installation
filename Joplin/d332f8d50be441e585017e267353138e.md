id: d332f8d50be441e585017e267353138e
parent_id: 
item_type: 1
item_id: 16dd1e26147a42e48907c36b5489e296
item_updated_time: 1723448089163
title_diff: "[{\"diffs\":[[1,\"Redis\"]],\"start1\":0,\"start2\":0,\"length1\":0,\"length2\":5}]"
body_diff: "[{\"diffs\":[[1,\"ردیس یک دیتابیس key-value است و به عنوان یک in-memory cache هم استفاده میشود. ما در پروژه BTM این دیتابیس را کلاستر کردیم و در اینجا نحوه راه اندازی آن را مستند کرده ایم:\\\n\\\nبرای نصب ردیس ابتدا نیازمندی های آن را نصب میکنیم:\\\nyum install make gcc libc6-dev tcl\\\n\\\n و سپس بسته موردنظر را از اینترنت میگیریم( برای این کار هم میتوان روی سرور پراکسی کرد هم بسته را جداگانه از اینترنت بگیریم و روی سرور بگذاریم)\\\n\\\n\\\nwget http://download.redis.io/redis-stable.tar.gz\\\ntar xvzf redis-stable.tar.gz\\\ncd redis-stable\\\nsudo make install\\\n\\\nفقط در نظر بگیرید به این دلیل که ما برنامه ها را در مسیر \\\"/opt\\\" قرار میدهیم بهتر است بسته را در همین مسیر باز کرده و قرار دهیم.\\\n\\\nدر این نصب ما سه سرور مجازی برای هر نود ردیس در نظر گرفته ایم.بر روی هر سرور یک master و یک slave بالا می آوریم , در واقع سه نود خواهیم داشت که تشکیل کلاستر میدهند.\\\n![920da0addeb035b033ee4901468a54e7.png](:/ad2057dc045c453b9f3202c49731c6a6)\\\n\\\n\\\n\\\nدر اصل ترتیب master و slave ها به این شکل خواهد بود:\\\n\\\n![119a541b81c71dafde922a5f447381ca.png](:/d7d97154f5a44f32bd222579ba4d8765)\\\n\\\nMASTER\\\nserver1:6379\\\nSLAVE\\\nserver2:6379\\\nSLAVE\\\nserver3:6380\\\nMASTER\\\nserver2:6380\\\nMASTER\\\nserver3:6381\\\n\\\nSLAVE\\\nserver1:6381\\\n\\\n\\\n\\\n\\\n\\\nمرحله بعد کانفیگ فایل های مربوطه است.\\\n\\\nبه یکی از سرورها ssh میکنیم و سپس به مسیر  \\\"/opt/redis-stable/\\\"  رفته و کانفیگ فایل های ردیس را طبق تصویر بالا انجام می دهیم.برای مثال بر روی سرور اول دو پورت ۶۳۷۹ و ۶۳۸۱ بالا می آوریم و یکی نقش master را بازی میکند که با A  مشخص شده است و دیگری یک slave میشود برای نود مستر روی سرور سوم که با C  مشخص شده است.\\\n\\\nبنابراین برای سرور اول به این شکل عمل میکنیم:\\\n\\\n\\\ncp redis.conf c_slave.conf\\\nmv redis.conf a_master.conf\\\n\\\n\\\nسپس فایل a_master.conf رو باز میکنیم و موارد زیر را در آن کانفیگ میکنیم:\\\n#bind 127.0.0.1\\\nprotected-mode no\\\nport 6379\\\ndaemonize yes\\\nsupervised systemd\\\npidfile /var/run/redis_6379.pid\\\nlogfile \\\"/opt/log/redis_6379\\\"\\\ndir /opt/dumpdb\\\ncluster-enabled yes\\\ncluster-config-file nodes-6379.conf\\\ncluster-node-timeout 15000\\\n\\\nسپس فایل  c_slave.conf را کانفیگ میکنیم:\\\n\\\n\\\n#bind 127.0.0.1\\\nprotected-mode no\\\nport 6381\\\ndaemonize yes\\\nsupervised systemd\\\npidfile /var/run/redis_6381.pid\\\nlogfile \\\"/opt/log/redis_6381\\\"\\\ndir /opt/dumpdb\\\ncluster-enabled yes\\\ncluster-config-file nodes-6381.conf\\\ncluster-node-timeout 15000\\\n\\\n\\\nنکته: به تفاوت پورتها در کانفیگ ها دقت نمایید.مسیر دایرکتوری های لازم برای لاگ ها و فایل های دیتابیس(مقادیر متناسب با logfile و dir ) باید وجود داشته باشند.ما آنها را در مسیر /opt در نظر گرفته ایم.\\\n\\\nهمین مراحل را برای دو سرور باقیمانده با توجه به جدول زیر انجام دهید:\\\n\\\n\\\nدر سرور دوم این کارها را انجام میدهیم:\\\ncp redis.conf a_slave.conf\\\nmv redis.conf b_master.conf\\\n\\\n و در سرور سوم:\\\ncp redis.conf b_slave.conf\\\nmv redis.conf c_master.conf\\\n\\\n\\\nبعد از اینکه در هر سه سرور فایل های مربوط به redis را کانفیگ کردیم , به سراغ اجرای آنها میرویم.برای اجرا و بالا آمدن سرویس در سرور اول به طریق زیر عمل میکنیم:\\\ncd /opt/redis-stable\\\nredis-server a_master.conf\\\nredis-server c_slave.conf\\\n\\\nهمین کار را در دو سرور دیگر با فایل های کانفیگ مربوطه انجام میدهیم.فقط حتما از بالا آمدن پورت های موردنظر بر روی سرورها اطمینان حاصل کنید.\\\n\\\n\\\nکار بعدی ایجاد کردن کلاسترهاست.برای انجام اینکار کافی است روی یکی از سرورها دستور زیر را اجرا کنیم:\\\nredis-cli --cluster create 192.168.240.162:6379 192.168.240.163:6380 192.168.240.164:6381\\\n\\\n\\\nبرای چک کردن بالا آمدن سرویس ها کافی است این دستورات را بر روی سرور اجرا کنیم(برای مثال سرور اول):\\\nredis-cli -c -h ip.of.server1 -p 6379\\\nip.of.server1>CLUSTER NODES\\\n\\\n\\\nدر ادامه باید نودهای slave را به نودهای master آن بشناسانیم:\\\nredis-cli --cluster add-node 192.168.240.163:6379 192.168.240.162:6379 --cluster-slave --cluster-master-id \\\"\\\"\\\n \\\nredis-cli --cluster add-node 192.168.240.164:6380 192.168.240.163:6380 --cluster-slave --cluster-master-id \\\"\\\"\\\n \\\nredis-cli --cluster add-node 192.168.240.162:6381 192.168.240.164:6381 --cluster-slave --cluster-master-id \\\"\\\"\\\n\\\n\\\nو باز هم برای چک کردن درستی انجام شدن این کار میتوان دستور زیر را اجرا کرد:\\\nredis-cli -c -h ip.of.server1 -p 6379\\\nip.of.server1>CLUSTER INFO\\\n \\\n \\\nor\\\n \\\n \\\n \\\n \\\nip.of.server1>INFO replication\\\n\\\nبه این ترتیب کلاستر ردیس ما با سه نود master و سه نود slave انجام شد.\\\n\\\n\\\nبرای تست کردن اینکه میتوان مقادیر را در دیتابیس ها وارد کرد میتوان(برای مثال) به شکل زیر عمل کرد:\\\nip.of.server1:6379> SET John Adams\\\n-> Redirected to slot [6852] located at ip.of.server2:6380\\\nOK\\\n \\\n \\\nip.of.server2:6380> SET James Madison\\\n-> Redirected to slot [2237] located at ip.of.server1:6379\\\nOK\\\nip.of.server1:6379> SET Andrew Jackson\\\n-> Redirected to slot [15768] located at ip.of.server3:6381\\\nOK\\\nip.of.server3:6381> GET John\\\n-> Redirected to slot [6852] located at ip.of.server2:6380\\\n\\\"Adams\\\"\\\nip.of.server2:6380>\\\n\\\n\\\n\\\nمرحله بعدی درست کردن سرویس برای Redis است.برای این کار باید در هر سرور با توجه به پورتی که برای نودهای master , slave در نظر گرفته بودیم , باید یک فایل برای سرویس master و یک فایل برای سرویس slave ایجاد کنیم:\\\ncat /etc/systemd/system/redisS.service\\\n \\\n[Unit]\\\nDescription=Redis In-Memory Data Store\\\nAfter=network.target\\\n[Service]\\\nType=notify\\\nExecStart=/usr/local/bin/redis-server /opt/redis-stable/c_slave.conf\\\nExecStop=/usr/local/bin/redis-cli -h 127.0.0.1 -p 6381 shutdown\\\nRestart=always\\\n \\\n[Install]\\\nWantedBy=multi-user.target\\\ncat  /etc/systemd/system/redisM.service\\\n \\\n[Unit]\\\nDescription=Redis In-Memory Data Store\\\nAfter=network.target\\\n \\\n[Service]\\\nType=notify\\\nExecStart=/usr/local/bin/redis-server /opt/redis-stable/a_master.conf\\\nExecStop=/usr/local/bin/redis-cli -h 127.0.0.1 -p 6379 shutdown\\\nRestart=always\\\n \\\n[Install]\\\nWantedBy=multi-user.target\\\n\\\n\\\nو سپس به این ترتیب میتوانید سرویس های ردیس را استاپ و استارت کنید:\\\nsystemctl start redisS\\\nsystemctl start redisM\\\nsystemctl status redisS\\\n...\\\n\\\nو برای فعال کردن سرویس ها که در زمان بوت سیستم بالا بیایند:\\\nsystemctl enable redisS\\\nsystemctl enable redisM\\\n\\\n\\\n\\\n\"]],\"start1\":0,\"start2\":0,\"length1\":0,\"length2\":5647}]"
metadata_diff: {"new":{"id":"16dd1e26147a42e48907c36b5489e296","parent_id":"9051567a85b34643b4e0252a8fdf0ac0","latitude":"35.68919750","longitude":"51.38897360","altitude":"0.0000","author":"","source_url":"","is_todo":0,"todo_due":0,"todo_completed":0,"source":"joplin-desktop","source_application":"net.cozic.joplin-desktop","application_data":"","order":0,"markup_language":1,"is_shared":0,"share_id":"","conflict_original_id":"","master_key_id":"","user_data":"","deleted_time":0},"deleted":[]}
encryption_cipher_text: 
encryption_applied: 0
updated_time: 2024-08-12T07:39:51.170Z
created_time: 2024-08-12T07:39:51.170Z
type_: 13