Installing Minio

برنامه minio یک ابزار open source می باشد که با زبان go نوشته شده و به عنوان یک object storage برای ذخیره سازی داده های بدون ساختار مانند عکس , فیلم , log file و container ها و ... مورد استفاده قرار میگیرد و قابلیت ذخیرسازی داده به بزرگی حداکثر 5TB را دارد. ایم minio از چندین نوع فضای ذخیره سازی از جمله دیسک محلی ، Kubernetes PVC ، NAS و Public Cloud ها مانند Azure و GCP پشتیبانی می کند و highavailability و Horizontal and vertical scaling وقابلیت رمزگذاری از ویژگی های مهم این ابزار است.

### **مراحل نصب minio**

1- برای نصب minio حداقل به 4 نود نیاز داریم و میبایست تعداد نود ها حتما زوج باشند.(4و6و8و...)

2- داخل تمامی نود ها و در مسیر /etc/hosts آی پی نود ها به همراه یک نام منحصربفرد برای هریک قرار داده میشود:

![ca8e916cc14793394291769915a9e360.png](:/77c46c6a0c7a4644af95c6d4b6de3e9d)

3- روی تمامی نود ها یوزرminio را اضافه میکنیم:

`useradd -s /sbin/nologin -d /opt/minio minio`

4-دایرکتوری مربوط به minio رو داخل تمامی نود ها ایجاد می کنیم:

`mkdir -p /opt/minio/bin`

5- minio را از مسیر زیر دانلود کرده و روی تمامی نود ها کپی میکنیم و یا دستور wget را روی تمامی نود ها اجرا میکنیم تا minio دانلود شود.

`wget https:``//dl.minio.io/server/minio/release/linux-amd64/minio -O /opt/minio/bin/minio`

6- برای افزودن مود exec از دستور روی همه نود ها زیر استفاده می شود:

`chmod +x /opt/minio/bin/minio`

7-فایل کانفیگ را برای قرار دادن enviroment ها روی نود های minio ایجاد کرده و مقادیر زیر را در آن ها وارد می کنیم:

`vim /opt/minio/minio.conf`

`MINIO_ACCESS_KEY=XXXXXXX`

`MINIO_SECRET_KEY=YYYYYYYY`

\*\*نکته: به خاطر داشته باشید که هر دو مقدار روی همه ی نود ها باید یکسان باشند. <span style="color: #ff0000;">(access key در واقع یوزر اصلی مینیو میباشد و secret key پسورد اصلی آن)</span>  
\*\*

**سپس روی تمامی نود ها این دستورات اجرا می شود:**

`export MINIO_ACCESS_KEY=XXXXXXXX`

`export MINIO_SECRET_KEY=YYYYYYYY`

8-پس از انجام این موارد می بایست مسیر مناسب برای داده های minio ایجاد کنیم که برای این کار مطابق با تعداد نود های کلاستر minio (مثلا 8تا) دستور را اجرا میکنیم:

### **<span style="color: #ff0000;">نکته: با استفاده از روشی که در ادامه توضیح داده شده است،تمامی obgect ها در یک درایور قرار میگیرند و تنها دایرکتوری های محل ذخیره ی آبجکت ها و مقادیر backup آنها متفاوت است.</span>**

### **<span style="color: #ff0000;">ولی ویژگی erasure coding برای نگهداری بهتر از داده ها و کاهش احتمال از دست رفتن داده پیشنهاد شده است که در صفحه ی [minio erasure coding](https://wiki.sadad.co.ir/display/Linux/minio+erasure+coding) از این ویژگی برای راه اندازی minio استفاده می کنیم .</span>**

`mkdir /data{``1``..``8``}`

9- پس از ایجاد مسیر ها, owner تمامی دایرکتوری های مربوط به minio را تغییر میدهیم:

`chown -R minio. /opt/minio /data{``1``..``8``}`

10-سپس دستور زیر را برای تست سرویس اجرا میکنیم:

`/opt/minio/bin/minio server http:``//stg{1...8}/data{1...8}`

نکته: میتوان دستور بالا را به صورت جداگانه روی تک تک نود ها و <span style="color: #ff0000;">حتما به صورت همزمان</span> اجرا کرد (به جای n شماره ی نود جایگزین میشود)

`/opt/minio/bin/minio server http:``//fida-minio(n)/data(n)`

11- در صورت موفقیت آمیز بودن تست می توان ui سرویس minio را با آدرس http://machine-ip:9000 داخل مرورگر بررسی کرد.

12- در آخر می توان با نوشتن سرویس minio را مدیریت نمود:

`vim /etc/systemd/system/minio.service`

`[Unit]`

`Description=MinIO`

`Requires=network-online.target`

`After=network-online.target`

`[Service]`

`WorkingDirectory=/opt/minio`

`User=minio`

`Group=minio`

`Type=simple`

`#ExecStartPre=/bin/sleep` `60`

`RemainAfterExit=yes`

`EnvironmentFile=/opt/minio/minio.conf`

`ExecStart=/opt/minio/bin/minio server http:``//fidaminiog{1...8}/data{1...8}`

`Restart=on-abort`

`[Install]`

`WantedBy=multi-user.target`

13- فعالسازی و استفاده از سرویس:

`systemctl daemon-reload`

`systemctl enable minio`

`systemctl start minio`

`systemctk status minio`

## <span style="color: #0000ff;">**مراحل نصب**</span> <span style="color: #0000ff;">**mc**</span>

<span style="color: #000000;">1- mc را از مسیر زیر دانلود کرده و روی سرور کپی میکنیم و یا دستور wget را روی نود مورد نظر اجرا میکنیم تا mc دانلود شود.  
</span>

`wget https:``//dl.min.io/client/mc/release/linux-amd64/mc`

2- سپس برای اینکه mc قابلیت اجرا داشته باشد از دستور زیر برای کپی کردن آن در مسیر مناسب استفاده میکنیم:

`cp mc /usr/local/bin`

`chmod +x /usr/local/bin/mc`

3- در آخر نیز بری برقراری ارتباط mc با سرویس minio مورد نظر وارد کانفیگ مربوط به mc شده و server access key و secret key مربوط به minio را در آن جایگزین میکنیم:

`vim .mc/config.json`

### <span style="color: #0000ff;">**ایجاد یوزر در minio به همراه مدیریت**</span> <span style="color: #0000ff;">**policy**</span>

<span style="color: #000000;">minio به صورت پیش فرض دارای policy های زیر می باشد `writeonly`, `readonly` و `readwrite` که به صورت پیش فرض برای تمامی یوزر ها فعال می باشد اما با ایجاد policy های جدید قابل تغییر هستند.</span>

<span style="color: #000000;">1-برای ایجاد یک policy جدید نیاز به ایجاد یک فایل json با فرمت استاندارد nminio است که نمونه ی آن را در زیر مشاهده میکنید:</span>

**getonly.json**

`{`

`"Version"``:` `"2012-10-17"``,`

`"Statement"``: [`

`{`

`"Action"``: [`

`"s3:GetObject"`

`],`

`"Effect"``:` `"Allow"``,`

`"Resource"``: [`

`"arn:aws:s3:::my-bucketname/*"`

`],`

`"Sid"``:` `""`

`}`

`]`

`}`

یوزر هایی که این policy به آنها اضافه می شود فقط دسترسی دانلود object ها از bucket مورد نظر را خواهند داشت.

<span style="color: #ff0000;">جهت ایجاد policy های مختلف میتوادن از لینک آخر همین صفحه بخش policy variables استفاده کرد.  
</span>

2- پس از ذخیره ی فایل json با نام مناسب (در این مثال `getonly.json`) با دستور زیر policy مورد نظر تعریف میشود:

`mc admin policy add myminio getonly getonly.json (myminio=minio service name)`

3- برای تعریف یوزر جدید از دستور زیر استفاده می شود:

`mc admin user add myminio (username) (password)`

`پاک کردن یوزر:`

`mc admin user remove myminio (username)`

4- سپس با دستور زیر policy های مورد نظر را به یوزر نسبت می دهیم:

`mc admin policy set myminio (policyname) user=(username)`

5- دستور زیر نیز برای لیست کردن یوزر ها مورد استفاده قرار میگیرد:

`mc admin user list myminio`

id: cb84b2a22ba44faeb9d37d5d34a5df31
parent_id: 9051567a85b34643b4e0252a8fdf0ac0
created_time: 2024-08-13T08:18:31.215Z
updated_time: 2024-08-13T08:23:12.610Z
is_conflict: 0
latitude: 35.68919750
longitude: 51.38897360
altitude: 0.0000
author: 
source_url: 
is_todo: 0
todo_due: 0
todo_completed: 0
source: joplin-desktop
source_application: net.cozic.joplin-desktop
application_data: 
order: 0
user_created_time: 2024-08-13T08:18:31.215Z
user_updated_time: 2024-08-13T08:23:12.610Z
encryption_cipher_text: 
encryption_applied: 0
markup_language: 1
is_shared: 0
share_id: 
conflict_original_id: 
master_key_id: 
user_data: 
deleted_time: 0
type_: 1