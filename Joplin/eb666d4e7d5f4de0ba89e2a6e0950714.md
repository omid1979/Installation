id: eb666d4e7d5f4de0ba89e2a6e0950714
parent_id: 2050fc464acb4ac1a5fede050e1a56a8
item_type: 1
item_id: f09253d6d5cd4ec09edb7bfae17e1789
item_updated_time: 1724650122107
title_diff: "[]"
body_diff: "[{\"diffs\":[[0,\"nagement\"],[1,\"\\\n\\\n\\\n\\\nدر این مستند به نحوه نصب و راه اندازی elk stack میپردازیم . elk stack مجتمع از سه محصول open source است که عبارتند از : elastic search  , logtash , kibana\\\n\\\nElastic Stack\\\n\\\n\\\n\\\nelastic stack  یک موتور جستجو و تحلیل کاملا متنی است که بر اساس موتور جستجوی apache lucene طراحی و ساخته شده است .\\\n\\\nlogstach یک مجتمع کننده لاگ است که از ورودی های مختلف داده میگیرد و بعد از انجام یک سری تغییرات و بهبودها ، داده ها را به خروجی های مختلفی میفرستد.\\\n\\\nkibana یک لایه ویژوال است که بالای elastic search قرار میگیرد و به کاربر امکان تصویری کردن داده ها و آنالیز کردن آنها را میدهد.\\\nنصب و کانفیگ Elastic Search: \\\n\\\nبرای نصب باید تمامی این دستورات بر روی سروری اجرا شود که به اینترنت دسترسی دارد.\\\n\\\nمرحله اول: تنظیم ریپوزیتوری yum  برای نصب پکیج های مورد نیاز elk stackاست :\\\n## ------------------------\\\n## Configure yum repository\\\n## ------------------------\\\n## Download and install the public signing key\\\nsudo rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch\\\n  \\\n## Create the repository file\\\nsudo vi /etc/yum.repos.d/elasticsearch.repo\\\n---------------------\\\n[elasticsearch]\\\nname=Elasticsearch repository for 7.x packages\\\nbaseurl=https://artifacts.elastic.co/packages/7.x/yum\\\ngpgcheck=1\\\ngpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch\\\nenabled=1\\\nautorefresh=1\\\ntype=rpm-md\\\n---------------------\\\n:wq\\\n\\\n\\\nمرحله دوم: نصب elastic search و اجرا کردن سرویس آن است\\\n## ---------------------\\\n## Install elasticsearch\\\n## ---------------------\\\n## Install elasticsearch\\\nsudo yum install elasticsearch\\\n \\\n## Enable and start elasticsearch\\\nsudo systemctl enable elasticsearch\\\nsudo systemctl start elasticsearch\\\nsudo systemctl status elasticsearch\\\n \\\n## Check if elasticsearch installed successfully\\\ncurl -X GET \\\"localhost:9200/?pretty\\\"\\\n\\\n\\\nمرحله سوم: کانفیگ elastic search \\\n## View elasticsearch configuration\\\nsudo cat /etc/elasticsearch/elasticsearch.yml\\\n \\\n##need to change these directories\\\npath.data: /opt/elasticsearch/data\\\npath.logs: /opt/elasticsearch/log\\\n \\\n##need to change ip and port\\\nnetwork.host: 172.29.140.3(IP-OF-SERVER)\\\nhttp.port: 9200\\\n \\\n \\\n##define single-node\\\ndiscovery.type: single-node\\\n\\\n\\\n\\\nنصب و کانفیگ Kibana:\\\n\\\n\\\n## --------------\\\n## Install kibana\\\n## --------------\\\n## Install kibana\\\nsudo yum install kibana\\\n  \\\n## Enable and start kibana\\\nsudo systemctl enable kibana\\\nsudo systemctl start kibana\\\nsudo systemctl status kibana\\\n  \\\n \\\n## Stop firewall\\\n## or open kibana default port using firewall-cmd --add-port=5601/tcp --permanent\\\nsudo systemctl stop firewalld\\\n  \\\n## Restart kibana\\\nsudo systemctl restart kibana\\\n\\\nبرای کانفیگ هم کافی است مقدار آی پی سرور را وارد کنیم:\\\n## View and eidt kibana configuration to connect remotely\\\nsudo vi /etc/kibana/kibana.yml\\\n---------------------\\\nserver.host: \\\"IP-OF-SERVER\\\"\\\n---------------------\\\n:wq\\\n\\\n\\\nبرای تست صحت بالا آمدن kibana ، میتوانید آدرس و پورت آن را در browser وارد کنید :    http://IP-OF-Server:5601\\\n\\\nکار دیگری که بهتر است انجام دهیم نصب پلاگین logtrail  در کیباناست .برای این کار کافی است که مراحل زیر را انجام دهیم:\\\n## get the same version of kibana\\\nwget  https://github.com/sivasamyk/logtrail/releases/download/v0.1.31/logtrail-7.9.2-0.1.31.zip\\\n \\\n##install logtrail\\\n##cd kibana bin\\\n./kibana-plugin --allow-root install file:///root/logtrail-7.9.2-0.1.31.zip\\\n\\\n\\\nنصب و کانفیگ Logstash:\\\n\\\n\\\n## ----------------\\\n## Install Logstash\\\n## ----------------\\\n## Install logstash\\\nsudo yum install logstash\\\n  \\\n## Enable and start logstash\\\nsudo systemctl start logstash\\\nsudo systemctl enable logstash\\\nsudo systemctl status logstash\\\n\\\n\\\nفایل های کانفیگ logstash نیز در این مسیر قرار دارد:   /etc/logstash\\\n\\\nکاری که ما قرار است در اینجا انجام دهیم ، فرستادن لاگ های سرورها  از طریق filebeat به logstash است .برای این کار باید چند کا رانجام داد. در مرحله اول کانفیگ کردن logtash :\\\n## ----------------\\\n## cd /etc/logstash/conf.d/\\\nvim filebeat.conf\\\ninput {\\\n  beats {\\\n    port => 5044\\\n  }\\\n}\\\n \\\n# The filter part of this file is commented out to indicate that it\\\n# is optional.\\\n# filter {\\\n#\\\n# }\\\n \\\noutput {\\\n  elasticsearch {\\\n    hosts => \\\"localhost:9200\\\"\\\n    manage_template => false\\\n    index => \\\"%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}\\\"\\\n  }\\\n}\\\n\\\nکار دیگری که باید انجام داد نصب کردن پلاگینهای input , output که در فایل تعریف کردیم است. (برای این کار نیاز است که سرور اینترنت داشته باشد)\\\n##cd /usr/share/logstash/bin\\\n./logstash-plugin install logstash-input-beats\\\n./logstash-plugin install logstash-output-elasticsearch\\\n\\\n\\\nفعال کردن x-pack بر روی elkstack :\\\n\\\nبرای انجام این کار باید دستورات زیر را انجام دهید:\\\n####note: every thing in ELK_HOME and ELK_CONFIG must be owned by elasticsearch\\\n1- Create a certificate authority for your Elasticsearch cluster. path of certificate file must under /etc/elasticsearch\\\n# bin/elasticsearch-certutil ca\\\n \\\n2- Generate a certificate and private key for each node in your cluster\\\n# bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12\\\n \\\n3- edit elasticsearch.yml and add bellow line\\\nxpack.security.enabled: true\\\nxpack.security.transport.ssl.enabled: true\\\nxpack.security.transport.ssl.verification_mode: certificate\\\nxpack.security.transport.ssl.keystore.path: /etc/elasticsearch/certs/elastic-certificates.p12\\\nxpack.security.transport.ssl.truststore.path: /etc/elasticsearch/certs/elastic-certificates.p12\\\n \\\n4- change ownership to elasticsearch\\\n# chown -R elasticsearch. /usr/share/elasticsearch /etc/easticsearch\\\n5- run these commands\\\n#bin/elasticsearch-keystore add xpack.security.http.ssl.keystore.secure_password\\\n#bin/elasticsearch-keystore add xpack.security.http.ssl.truststore.secure_password\\\n#bin/elasticsearch-keystore add xpack.security.transport.ssl.keystore.secure_password\\\n#bin/elasticsearch-keystore add xpack.security.transport.ssl.truststore.secure_password\\\n \\\n6- restart elasticsearch\\\n# systemctl restart elasticsearch\\\n \\\n7- create password for default user\\\n# bin/elasticsearch-setup-passwords interactive\\\n \\\n8- edit kibana to use user/pass to connect elasticsearch . edit bellow line in kibana.yml\\\nelasticsearch.username: \\\"kibana_system\\\"\\\nelasticsearch.password: \\\"123456\\\"\\\n \\\n9- edit logstash to connect with user/pass to elasticsearch\\\n• edit logstash.yml and edit bellow line:\\\nxpack.monitoring.enabled: true\\\nxpack.monitoring.elasticsearch.username: logstash_system\\\nxpack.monitoring.elasticsearch.password: 123456\\\nxpack.monitoring.elasticsearch.hosts: [\\\"http://IP-OF-Server:9200\\\"]\\\nxpack.management.enabled: true\\\nxpack.management.pipeline.id: [\\\"main\\\", \\\"apache_logs\\\"]\\\nxpack.management.elasticsearch.username: logstash_admin_user\\\nxpack.management.elasticsearch.password: 123456\\\nxpack.management.elasticsearch.hosts: [\\\"http://IP-OF-Server:9200\\\"]\\\n• edit output config\\\nhosts => [\\\"192.168.209.51:9200\\\"]\\\nuser => \\\"elastic\\\"\\\npassword => \\\"123456\\\"\\\n\\\n\\\nتوجه کنید که در فایل کانفیگ logstash باید مقادیر input , output مشخص شده باشند.\\\n\\\n\\\nتوجه داشته باشید که اگر قرار باشد نسخه خاصی از elk stack را بر روی سیستم خود نصب کنید باید این مراحل را طی کنید:\\\n##find the appropriate version :\\\nyum list elasticsearch --showduplicates\\\n \\\n##install the version , for exmaple 7.9.2\\\nyum install elasticsearch-7.9.2-1\\\n\\\nتوجه داشته باشید که باید ورژنهای تمام ابزارهای استک ، یکی باشد .یعنی نسخه elastic search و kibana و logsatsh و حتی پلاگینهایی مثل logtrail که بر روی کیبانا نصب میشود.\\\n\\\n\\\nنصب و کانفیگ Filebeat :\\\n\\\nبرای نصب کافی است مراحل زیر را طی کنید:\\\n##add key\\\nsudo rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch\\\n \\\n##add elastic repository\\\nvim /etc/yum.repos.d/elastic.repo\\\n \\\n[elastic-7.x]\\\nname=Elastic repository for 7.x packages\\\nbaseurl=https://artifacts.elastic.co/packages/7.x/yum\\\ngpgcheck=1\\\ngpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch\\\nenabled=1\\\nautorefresh=1\\\ntype=rpm-md\\\n \\\n##install\\\nyum install filebeat\\\n\\\n\\\nبه منظور کانفیگ کردن فایل بیت کافی است این موارد را کانفیگ کنیم:\\\n##vim /etc/filebeat/filebeat.yml\\\n \\\n*************\\\n- type: log\\\n \\\n  # Change to true to enable this input configuration.\\\n  enabled: true\\\n \\\n  # Paths that should be crawled and fetched. Glob based paths.\\\n  paths:\\\n    - /opt/ibm/wlp/usr/servers/defaultServer/logs/console.log\\\n    - /opt/ibm/wlp/usr/servers/defaultServer01/logs/console.log\\\n*********************\\\nin general part add tags:\\\n \\\ntags: [\\\"baam-api_107.133\\\"]\\\n \\\n***************************\\\nadd kibana host in \\\"kibana\\\" part:\\\n \\\nhost: \\\"172.29.140.3:5601\\\"\\\n \\\n***************************\\\nadd logstash host in \\\"Logstash Output\\\" part:\\\n \\\n hosts: [\\\"172.29.140.3:5044\\\"]\\\n****************************\\\n \\\n \\\n \\\nsudo systemctl enable filebeat\\\nsudo systemctl restart filebeat\\\nنصب و کانفیگ Curator :\\\n\\\nبه منظور بهینه کردن ایندکس های الک از ابزار مربوطه استفاده میکنیم.برای نصب این پکیج کافی است کارهای زیر را انجام دهیم:\\\n##Download and install the public signing key:\\\nrpm --import https://packages.elastic.co/GPG-KEY-elasticsearch\\\n \\\n##add curator repo file\\\nvim /etc/yum.repos.d/curator.repo\\\n \\\n[curator-5]\\\nname=CentOS/RHEL 7 repository for Elasticsearch Curator 5.x packages\\\nbaseurl=https://packages.elastic.co/curator/5/centos/7\\\ngpgcheck=1\\\ngpgkey=https://packages.elastic.co/GPG-KEY-elasticsearch\\\nenabled=1\\\n \\\n \\\n##install\\\n yum install elasticsearch-curator\\\n\\\n\\\n\\\n\"]],\"start1\":21,\"start2\":21,\"length1\":8,\"length2\":8962}]"
metadata_diff: {"new":{},"deleted":[]}
encryption_cipher_text: 
encryption_applied: 0
updated_time: 2024-08-26T05:37:01.941Z
created_time: 2024-08-26T05:37:01.941Z
type_: 13