پیاده سازی OpenStack

[Skip to end of metadata](https://wiki.sadad.co.ir/pages/viewpage.action?pageId=32902940#page-metadata-end)

- Created by [poorya rastegar](https://wiki.sadad.co.ir/display/~prastegar), last modified on [Jun 09, 2019](https://wiki.sadad.co.ir/pages/diffpagesbyversion.action?pageId=32902940&selectedPageVersions=3&selectedPageVersions=4 "Show changes")

[Go to start of metadata](https://wiki.sadad.co.ir/pages/viewpage.action?pageId=32902940#page-metadata-start)

برای راه اندازی اولیه Open Stack با معماری تستی پیشنهاد شده به 5 سرور نیاز داریم. نامگذاری این سرورهای بصورت زیر میباشد:

Controller

Compute

BlockStorage

ObjectStorage1

ObjectStorage2

گام اول: آماده سازی زیرساخت

ابتدا 5 ماشین فوق را آماده راه اندازی نمایید. برای این پروژه ما از یک CentOS استفاده کردیم. جهت نصب اولیه پیشنهاد میشود سرورهای شما دارای 8 گیگ رم، 4 هسته CPU و 20 گیگ فضای دیسک باشند.

پس از نصب سیستم عامل مربوطه آدرس IP آنرا بصورت دستی ثبت نمایید. SSH آنرا فعال کرده و تنظیمات مختص اتصال به آنرا انجام دهید.سیستم عامل را بروز رسانی کرده و ابزار git را نیز نصب نمایید. سپس hostname سیستم را به درستی تنظیم کنید

حال در فایل etc/hosts/ نام سرورهای خود را ثبت نمایید به عنوان مثال برای تست بنده موارد زیر ثبت شده است.

`10.10.10.7 controller`

`10.10.10.8 compute1`

`10.10.10.9 block1`

`10.10.10.10 object1`

`10.10.10.11 object2`

سپس پکیج ntp را نصب کرده و تنظیمات آنرا انجام دهید. توجه داشته باشید سرویس Selinux را غیر فعال نمایید و از تنظیمات فایروال خود کاملا آگاه باشید.

گام دوم: نصب و تنظیمات نیازمندی های راه اندازی Open Stack

ابتدا تنظیمات سیسیتم را انجام می دهیم:

`sudo` `systemctl disable firewalld`

`sudo` `systemctl stop firewalld`

`sudo` `systemctl disable NetworkManager`

`sudo` `systemctl stop NetworkManager`

`sudo` `systemctl` `enable` `network`

`sudo` `systemctl start network`

نکته: سرویس SElinux را غیرفعال نموده و سیستم را ریبوت نمایید.

سپس انباره داده RDO را به سیستم معرفی کرده و Packstack را نصب نمایید:

`sudo` `yum` `install` `-y https:``//rdoproject``.org``/repos/rdo-release``.rpm`

`sudo` `yum` `install` `-y centos-release-openstack-stein`

`yum-config-manager --``enable` `openstack-stein`

`sudo` `yum update -y`

`sudo` `yum` `install` `-y openstack-packstack`

گام سوم: تنظیمات Pack Stack و راه اندازی Open Stack

با کمک packstack می توانید تمامی پروژه ها در یک ماشین جهت تست راه اندازی کنید (دربخش قبل توضیح داده شد). برای انجام این کار می توانید از دستور زیر استفاده کنید:

`sudo` `packstack --allinone`

اما در صورتیکه قصد دارید open stack خود را در حالت Multi Node راه اندازی نمایید می توانید از مفهومی به نام Answer File استفاده کنید. تمامی تنظیمات نصب open stack و پروژه های آن در داخل فایلی وجود دارد که می توانید با تغییر آن نودهای مختلف و تنظیمات آنها را در آن تعریف کرده و به راحتی اقدام به نصب open stack نمایید.

جهت تولید این فایل از دستور زیر استفاده نمایید:

`packstack --gen-answer-``file``=poorya.conf`

همانگونه که مشاهده می کنید یک فایل تنظیمات تحت عنوان poorya.conf ایجاد کردیم که با ویرایش آن می توانید اقدام به نصب open stack نمایید.

بخشی از فایل را در قسمت زیر می توانید مشاهده کنید:

`# Default password to be used everywhere (overridden by passwords set`

`# for individual services or users).`

`CONFIG_DEFAULT_PASSWORD=`

`# The amount of service workers/threads to use for each service.`

`# Useful to tweak when you have memory constraints. Defaults to the`

`# amount of cores on the system.`

`CONFIG_SERVICE_WORKERS=%{::processorcount}`

`# Specify 'y' to install MariaDB. ['y', 'n']`

`CONFIG_MARIADB_INSTALL=y`

`# Specify 'y' to install OpenStack Image Service (glance). ['y', 'n']`

`CONFIG_GLANCE_INSTALL=y`

`# Specify 'y' to install OpenStack Block Storage (cinder). ['y', 'n']`

`CONFIG_CINDER_INSTALL=y`

`# Specify 'y' to install OpenStack Shared File System (manila). ['y',`

`# 'n']`

`CONFIG_MANILA_INSTALL=n`

`# Specify 'y' to install OpenStack Compute (nova). ['y', 'n']`

`CONFIG_NOVA_INSTALL=y`

`# Specify 'y' to install OpenStack Networking (neutron) ['y']`

`CONFIG_NEUTRON_INSTALL=y`

EXCLUDE_SERVERS

در این فایل قسمتی تحت عنوان EXCLUDE_SERVER وجود دارد. در صورتیکه قصد دارید با همین Answer file پرژه ای از اوپن استک را نصب کنید می توانید در این بخش آدرس سرورهایی که قصد دارید تغییری روی آنها ایجاد نشود و فقط پروژه جدید نصب شود را ثبت نمایید.

CONFIG_DEFAULT_PASSWORD

رمز ورود پیشفرض سرویس های اوپن استک می باشد

CONFIG_MARIADB_INSTALL=y

اجازه نصب MariaDB

CONFIG_GLANCE_INSTALL=y

اجازه نصب پروژه Glance

CONFIG_NETWORK_HOSTS

آدرس سروری که پروژه Neutron می بایست در آن نصب شود.

در مجموع با کمی جستجو در فایل می توانید از موارد استفاده کنید و فهم یادگیری آسانی دارد.

Open vSwitch

Open vSwitch یک سوئیچ مجازی چند لایه ای می باشد که از پروتکل های شبکه های سنتی به نسبت پشتیبانی می نماید. این سوییچ به زبان C نوشته شده و در در زیرساخت های مجازی سازی مبتنی بر لینوکس کاربرد دارد. از امکاناتی این سوییچ در اختیار قرار میدهد می توان به موارد زیر اشاره کرد:

- Standard 802.1Q VLAN model with trunk and access ports
- NIC bonding with or without LACP on upstream switch
- NetFlow, sFlow®, and mirroring for increased visibility
- QoS (Quality of Service) configuration, plus policing
- Geneve, GRE, VXLAN, STT, and LISP tunneling
- 802.1ag connectivity fault management
- OpenFlow 1.0 plus numerous extensions
- Transactional configuration database with C and Python bindings
- High-performance forwarding using a Linux kernel module

این سوییچ در کرنل لینوکس فعالیت می نمایید ولی در جدیدا OVS مختص Userspace نیز طراحی شده و امکان سازگاری خوبی با DPDK را دارا می باشد.

حال سوال اینجاست که در این بخش از OVS یا همان Open vSwitch نامی به میان آورده شده است.

در مجازی سازی مبتنی بر لینوکس، زمانیکه ماشین های مجازی به هر دلیل دچار مشکل می شوند و یا نیاز است جابجایی آنها از یک هاست به هاست دیگر وجود داشته باشد، تمامی تنظیمات سوئیچ های آن با ماشین مجازی جابجا نشده و فقط خود ماشین جابجا میشود. پس عملا در صورتیکه این ماشین در هاست ها و فوق ناظرهای جابجا شود تنظیمات شبکه آن مانند VLAN،‌ALC و بسیاری از موارد دیگر که در حوزه شبکه می باشد در هاست ها جابجا نخواهند شد. از این رو از OVS استفاده میشود.

زماینکه اوپن استک را نصب می نمایید اگر کارت شبکه های Master Node را مشاهده کنید با ۲ bridge بر خواهید خود.

id: b4bbfa385a7048b7b269617e2946dccd
parent_id: 178945c85174489ea06524f952d4f483
created_time: 2024-09-14T13:38:42.478Z
updated_time: 2024-09-14T13:39:04.248Z
is_conflict: 0
latitude: 35.68919750
longitude: 51.38897360
altitude: 0.0000
author: 
source_url: 
is_todo: 0
todo_due: 0
todo_completed: 0
source: joplin-desktop
source_application: net.cozic.joplin-desktop
application_data: 
order: 0
user_created_time: 2024-09-14T13:38:42.478Z
user_updated_time: 2024-09-14T13:39:04.248Z
encryption_cipher_text: 
encryption_applied: 0
markup_language: 1
is_shared: 0
share_id: 
conflict_original_id: 
master_key_id: 
user_data: 
deleted_time: 0
type_: 1