NFS

1- برای نصب NFS در هر دو ماشین(سرور و کلاینت) از دستور زیر استفاده میکنیم تا پکیج مربوطه به همراه Dependency  های آن نصب گردد.
yum install nfs-utils

2- سپس بر روی ماشین سرور دایرکتوری مورد نظر که می خواهیم share شود را ایجاد می کنیم(در این مثال ما دایرکتوری home که از قبل نیز وجود دارد هم share می کنیم) ، البته در صورتی که دایرکتوری مورد نظر از قبل وجود نداشته باشد.
mkdir /var/nfsshare

3- سپس تنظیمات مربوط به دسترسی ها برای دایکتوری ایجاد شده را انجام می دهیم.
chmod -R 755 /var/nfsshare
chown nfsnobody:nfsnobody /var/nfsshare

4- سپس سرویس های جانبی مربوط به nfs که هرکدام مسئولیت بخشی از کار را به عهده دارند را enable و start می کنیم.
systemctl enable rpcbind
systemctl enable nfs-server
systemctl enable nfs-lock
systemctl enable nfs-idmap
systemctl start rpcbind
systemctl start nfs-server
systemctl start nfs-lock
systemctl start nfs-idmap

5- در این مرحله باید در ماشین سرور network هایی که اجازه دسترسی به مسیر مورد نظر ما را دارند تعریف کنیم، ابتدا فایل etc/exports/ را با استفاده از vim باز کرده و کلاینت های مورد نظر به صورت زیر وارد می کنیم.
/var/nfsshare    192.168.159.154(rw,sync,no_root_squash,no_all_squash)
/home            192.168.159.154(rw,sync,no_root_squash,no_all_squash)

همانطور که ذکر شد ما می خواهیم یک دایرکتوری که از قبل موجود می باشد و یک دایرکتوری جدید را share کنیم، آی پی 192.168.159.154 در واقع آدرس ماشین کلاینت ما می باشند، همچنین می توان برای تعریف کلاینت از نام هاست و یا یک رنج آی پی شبکه ای نیز استفاده کرد.

نکته: درخصوص پارامتر های درج شده در داخل پرانتز در انتهای مستند توضیح داده خواهد شد.

6- پس از انجام مرحله قبل باید یک بار سرویس nfs را ریست کرد.
systemctl restart nfs-server

نکته : توجه داشته باشید در صورت داشتن firewalld آن را disable کرده و یا در صورت داشتن رول خاصی بر روی iptables که ترافیک های خاصی را می بندد شما باید دسترسی به پورت 2049 برای ارتباط دو ماشین را باز کنید.

7- پس از انجام تنظیمات می بایست nfs بر روی ماشین یا ماشین های کلاینت نیز نصب شود.
yum install nfs-utils

8- از آنجا که ما به تعداد 2 دایرکتوری از ماشین سرور می خواستیم share کنیم دایرکتوری های مورد نظر را در ماشین کلاینت ایجاد می کنیم.
mkdir -p /mnt/nfs/home
mkdir -p /mnt/nfs/var/nfsshare

9- سپس باید دایرکتوری های ایجاد شده در ماشین کلاینت را به دایرکتوری های موجود در ماشین سرور mount کنیم.
mount -t nfs 192.168.159.152:/home /mnt/nfs/home/
 mount -t nfs 192.168.159.152:/var/nfsshare /mnt/nfs/var/nfsshare

آی پی 192.168.159.152 آدرس ماشین سرور می باشد.

10- با استفاده از دستور ذیل از mount شدن مسیر ها اطمینان حاصل می کنیم.
df -kh

11- از آنجا که با ریست شدن سیستم عامل mount ها نیز از بین می روند باید در فایل fstab در دایکتوری etc نیز تنظیمات را انجام دهیم ، خطوط ذیل را به این فایل اضافه کرده و آن را ذخیره می کنیم.
192.168.159.152:/home    /mnt/nfs/home   nfs defaults 0 0
192.168.159.152:/var/nfsshare    /mnt/nfs/var/nfsshare   nfs defaults 0 0

پس از ذخیره فایل یک بار سیستم عامل را ریست می کنیم.

12- پس از ریست یک بار دیگر با استفاده از دستور df -kh مسیر های مورد نظر را کنترل می کنیم ، سپس برای تست اینکه آیا این مسیر ها بین ماشین سرور و کلاینت share شده است می توانید در ماشین کلاینت فایلی ایجاد کنید و این فایل را ماشین سرور نیز مشاهده خواهید کرد.

    پارامتر های قابل تنظیم در فایل etc/exports/:

    rw: مجوز هر دو عملیات خواندن و نوشتن بر روی فایل سیستم را فراهم میکند.به صورت پیشفرض هر عملیاتی که منجر به تغییر بر روی فایل سیستم شود، نادیده گرفته میشود، همانند رفتاری که در تنظیم ro در پیش گرفته میشود.
    async: این گزینه این امکان را فراهم میکند تا به درخواست های تغییر بر روی دیسک قبل از این که واقعا تغییری اعمال شود، پاسخ داده شود. در واقع به کلاینت گفته می شود تغییرات مورد نظر بر روی دیسک اعمال شده است ولی در عمل اینطور نیست. این گزینه میتواند کارایی سیستم را بهبود ببخشد اما در کنار این بهبود ریسک از دست رفتن اطلاعات در صورت ری استارت شدن ناگهانی سرور یا به اصطلاح unclean restart ( مانند شرایط کرش کردن کرنل و قطع برق سرور و …) نیز وجود دارد.
    sync: درخواست تغییر روی دیسک تنها و تنها زمانی به کلاینت ارسال می شود که تغییرات بر روی دیسک اعمال یا commit  شده باشد. از ورژن ۱ به بعد این گزینه به عنوان تنظیمات پیش فرض مورد استفاده قرار میگیرد.
    wdelay:  در صورتی که سرور تشخیص دهد ممکن است عملیات نوشتن دیگری مرتبط با عملیات فعلی بر روی دیسک انجام شود، عملیات نوشتن بر روی دیسک را با تاخیر انجام خواهد داد. این کار باعث میشود تا در یک عملیات نوشتن چندین درخواست را در دیسک نوشت. در نتیجه تعداد دفعات رجوع به دیسک جهت نوشتن داده بر روی آن کمتر میشود که در نتیجه آن کارایی سرور نیز بهبود می یابد. اما در مواقعی که درخواست های زیاد و نامرتبطی به سرور ارسال شود فعال بودن این گزینه عملا میتواند باعث کاهش کارایی و عملکرد سرور شود. این گزینه از تنظیمات پیش فرض است که جهت غیر فعال سازی آن میتوان از no_wdelay استفاده کرد.
    root_squash: در صورتی که کاربر root قصد دسترسی به فایلی را در nfs ‌ سرور داشته باشد. رفتار سرور با این کاربر هماهنند کاربر root در سرور اصلی خواهد بود. با فعال بودن این گزینه. uid کاربر root در سرور به  uid دیگری که متعلق به کاربر nobody است map میشود. در نتیجه سطح دسترسی کاربر در سرور به حداقل دسترسی ممکن کاهش می باید. برای غیر فعال سازی این گزینه از گزینه no_root_squash استفاده میشود.
    all_squash : عملکردی همانند عملکرد  root_squash‌دارد با این تفاوت که این عملکرد برروی تمامی کاربرای تاثیر گزار خواهد بود. غیر فعال سازی عملکرد این گزینه با no_all_squash امکان پذیر است. فعال کردن این گزینه برای فایل سیستم هایی که در دسترس عموم قرار میگیرند مناسب است.
    anonuid and anongid: با استفاده از این دو گزینه میتوان درخواست های یک فایل سیستم یا دایرکتوری را که از سمت کاربر anonymous  وارد می شود را به یک uid و  gid به خصوص map کرد. به عنوان مثال تصور کنید نام کاریری ای به نام javad با uid ‌ برابر با ۵۰۵  داریم. با انتخاب گزینه anouid=505 تمامی درخواست ها بر روی فایل ها با uid  کاربر javad ثبت و انجام می شوند.







id: 0ab4361530bf432bad3cf18ac54f60c9
parent_id: 9051567a85b34643b4e0252a8fdf0ac0
created_time: 2024-08-12T07:53:48.577Z
updated_time: 2024-08-12T07:53:59.694Z
is_conflict: 0
latitude: 35.68919750
longitude: 51.38897360
altitude: 0.0000
author: 
source_url: 
is_todo: 0
todo_due: 0
todo_completed: 0
source: joplin-desktop
source_application: net.cozic.joplin-desktop
application_data: 
order: 0
user_created_time: 2024-08-12T07:53:48.577Z
user_updated_time: 2024-08-12T07:53:59.694Z
encryption_cipher_text: 
encryption_applied: 0
markup_language: 1
is_shared: 0
share_id: 
conflict_original_id: 
master_key_id: 
user_data: 
deleted_time: 0
type_: 1